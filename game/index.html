<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>TerNix Online 3D</title>
    <!-- Подключаем движок -->
    <script src="https://unpkg.com"></script>
    <script src="https://unpkg.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: "Arial", sans-serif; }
        canvas { display: block; }

        /* ЭКРАН ВХОДА */
        #login-scr { position: fixed; inset: 0; background: #0055ff; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #login-scr input { padding: 15px; width: 300px; border: none; font-size: 20px; text-align: center; border-radius: 5px; margin-bottom: 20px; }
        #login-scr button { padding: 15px 80px; background: #00aa00; color: white; border: none; font-weight: bold; cursor: pointer; font-size: 20px; border-radius: 5px; }

        /* ИНТЕРФЕЙС ГЕЙМПЛЕЯ */
        header { position: absolute; top: 0; width: 100%; height: 45px; background: #0044ee; color: white; display: flex; align-items: center; padding: 0 20px; z-index: 500; border-bottom: 2px solid #002288; box-sizing: border-box; }
        header button { background: #fff; border: 1px solid #000; cursor: pointer; font-weight: bold; margin-right: 15px; padding: 3px 12px; }

        #stats-ui { position: absolute; top: 60px; right: 20px; background: rgba(0,0,0,0.6); padding: 10px; border: 2px solid #fff; z-index: 400; width: 180px; }
        #hp-bar { width: 100%; height: 18px; background: #333; margin-top: 5px; }
        #hp-fill { width: 100%; height: 100%; background: #ff0000; transition: 0.3s; }

        #chat-bar { position: absolute; bottom: 0; width: 100%; background: #fff; border-top: 3px solid #333; padding: 15px; z-index: 600; box-sizing: border-box; display: flex; }
        #chat-input { width: 100%; border: none; outline: none; font-size: 18px; }
        #chat-log { position: absolute; top: 60px; left: 20px; color: white; text-shadow: 2px 2px 2px #000; z-index: 400; font-size: 16px; pointer-events: none; }
    </style>
</head>
<body>

<div id="login-scr">
    <h1 style="font-size: 60px; margin-bottom: 20px;">TerNix</h1>
    <input type="text" id="username-input" placeholder="Enter @username">
    <button onclick="enterGame()">PLAY</button>
</div>

<header>
    <b style="font-size: 22px; margin-right: 30px;">TerNix</b>
    <button onclick="location.reload()">Home</button>
    <button>Games</button>
    <div style="margin-left:auto; font-weight: bold;">Hex: 100</div>
</header>

<div id="chat-log"></div>

<div id="stats-ui">
    <div style="color:white; font-size:12px; font-weight:bold;">HEALTH</div>
    <div id="hp-bar"><div id="hp-fill"></div></div>
</div>

<div id="chat-bar">
    <input type="text" id="chat-input" placeholder='Нажми "/" для чата...'>
</div>

<script>
    let scene, camera, renderer, player, username = "@Guest", hp = 100;
    let keys = {}, velocityY = 0, isJumping = false;
    const chatInput = document.getElementById('chat-input');
    const chatLog = document.getElementById('chat-log');

    function enterGame() {
        let val = document.getElementById('username-input').value;
        if(val) username = val.startsWith('@') ? val : '@' + val;
        document.getElementById('login-scr').style.display = 'none';
        init3D();
    }

    function init3D() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.9));
        scene.add(new THREE.GridHelper(200, 50, 0x000000, 0x444444));

        // DAMAGE PART (Красная зона)
        const lava = new THREE.Mesh(new THREE.BoxGeometry(6, 0.2, 6), new THREE.MeshPhongMaterial({color: 0xff0000}));
        lava.position.set(15, 0, -15);
        scene.add(lava);

        // ЗАГРУЗКА ТВОЕЙ МОДЕЛИ
        const loader = new THREE.GLTFLoader();
        loader.load('Ternix.Guy.glb', (gltf) => {
            player = gltf.scene;
            scene.add(player);
        }, undefined, () => {
            // Если модели нет в корне - создаем временного челика
            player = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(1, 1.3, 0.6), new THREE.MeshPhongMaterial({color: 0x888888}));
            player.add(body);
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.7), new THREE.MeshPhongMaterial({color: 0xffdbac}));
            head.position.y = 1.1;
            player.add(head);
            scene.add(player);
        });

        camera.position.set(0, 7, 12);

        window.addEventListener('keydown', (e) => {
            if(e.key === '/') { e.preventDefault(); chatInput.focus(); }
            if(e.code === 'Space' && !isJumping) { velocityY = 0.25; isJumping = true; }
            keys[e.code] = true;
        });
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if(player && document.activeElement !== chatInput) {
            // Ходьба
            if(keys['KeyW']) player.translateZ(-0.2);
            if(keys['KeyS']) player.translateZ(0.2);
            if(keys['KeyA']) player.rotation.y += 0.06;
            if(keys['KeyD']) player.rotation.y -= 0.06;

            // Физика прыжка
            player.position.y += velocityY;
            if(player.position.y > 0) velocityY -= 0.012;
            else { player.position.y = 0; velocityY = 0; isJumping = false; }

            // Зона урона
            if(Math.abs(player.position.x - 15) < 3 && Math.abs(player.position.z + 15) < 3) {
                hp -= 0.5; if(hp < 0) hp = 0;
                document.getElementById('hp-fill').style.width = hp + "%";
            }

            // Камера
            const camOffset = new THREE.Vector3(0, 7, 12).applyQuaternion(player.quaternion);
            camera.position.lerp(player.position.clone().add(camOffset), 0.1);
            camera.lookAt(player.position);
        }
        renderer.render(scene, camera);
    }

    chatInput.onkeypress = (e) => {
        if(e.key === 'Enter' && chatInput.value !== "") {
            chatLog.innerHTML += `<div><b>${username}:</b> ${chatInput.value}</div>`;
            chatInput.value = ""; chatInput.blur();
        }
    };
</script>
</body>
</html>
