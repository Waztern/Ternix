<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TerNix 3D - Game</title>
    <!-- Подключаем библиотеки напрямую через проверенный сервис -->
    <script src="https://unpkg.com"></script>
    <script src="https://unpkg.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; font-family: sans-serif; pointer-events: none; }
        #chat-wrap { position: absolute; bottom: 0; width: 100%; background: #fff; padding: 10px; display: flex; border-top: 3px solid #333; }
        #chat-input { width: 100%; border: none; outline: none; font-size: 18px; }
        #hp-ui { position: absolute; top: 10px; right: 10px; width: 150px; height: 20px; background: #333; border: 2px solid #fff; }
        #hp-bar { width: 100%; height: 100%; background: red; }
    </style>
</head>
<body>

<div id="ui"><b>TerNix 3D Engine</b><br>@username</div>
<div id="hp-ui"><div id="hp-bar"></div></div>

<div id="chat-wrap">
    <input type="text" id="chat-input" placeholder='Нажми "/" для чата...'>
</div>

<script>
    let scene, camera, renderer, player, clock, mixer;
    let keys = {};
    const chatInput = document.getElementById('chat-input');

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        clock = new THREE.Clock();

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);

        // Пол
        const grid = new THREE.GridHelper(100, 50);
        scene.add(grid);

        // Блок урона
        const lavaGeo = new THREE.BoxGeometry(4, 0.2, 4);
        const lavaMat = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        const lava = new THREE.Mesh(lavaGeo, lavaMat);
        lava.position.set(5, 0, 5);
        scene.add(lava);

        // ЗАГРУЗКА ТВОЕЙ МОДЕЛИ
        const loader = new THREE.GLTFLoader();
        // Путь к модели в той же папке
        loader.load('Ternix.Guy.glb', (gltf) => {
            player = gltf.scene;
            scene.add(player);
            // Если есть анимации в Blender
            if (gltf.animations.length) {
                mixer = new THREE.AnimationMixer(player);
                mixer.clipAction(gltf.animations[0]).play();
            }
        }, undefined, (err) => {
            console.error("Модель не найдена. Создаю временного челика.");
            player = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshPhongMaterial({color: 0x888888}));
            player.position.y = 1;
            scene.add(player);
        });

        camera.position.set(0, 5, 10);
        
        window.addEventListener('keydown', (e) => {
            if (e.key === '/') { e.preventDefault(); chatInput.focus(); }
            keys[e.code] = true;
        });
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        if (mixer) mixer.update(delta);

        if (player && document.activeElement !== chatInput) {
            if (keys['KeyW']) player.translateZ(-0.15);
            if (keys['KeyS']) player.translateZ(0.15);
            if (keys['KeyA']) player.rotation.y += 0.05;
            if (keys['KeyD']) player.rotation.y -= 0.05;
            
            // Прыжок (простой)
            if (keys['Space'] && player.position.y <= 1.1) player.position.y += 0.5;
            if (player.position.y > 1) player.position.y -= 0.05;

            // Камера за игроком
            const relativeCameraOffset = new THREE.Vector3(0, 5, 10);
            const cameraOffset = relativeCameraOffset.applyMatrix4(player.matrixWorld);
            camera.position.lerp(cameraOffset, 0.1);
            camera.lookAt(player.position);
        }

        renderer.render(scene, camera);
    }

    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') chatInput.blur();
    });

    init();
</script>
</body>
</html>
