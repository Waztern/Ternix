<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerNix - Home Update</title>
    <style>
        /* --- –ë–ê–ó–û–í–´–ô –°–¢–ò–õ–¨ (NO ROUNDED CORNERS) --- */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; user-select: none; background: #111; }
        
        /* –ö–Ω–æ–ø–∫–∏ –∏ UI - –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫—Ä–∞—è */
        button, input, .panel { border-radius: 0px !important; }

        /* --- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ (HOME) --- */
        #home-screen {
            position: absolute; inset: 0; background: #0d0d0d; z-index: 5000;
            display: flex; flex-direction: column; color: white;
        }
        .home-nav {
            height: 60px; background: #1e1e1e; display: flex; align-items: center; padding: 0 40px; border-bottom: 2px solid #333;
        }
        .currency-box {
            margin-left: auto; display: flex; gap: 20px; font-weight: bold; font-size: 18px;
        }
        .c-gold { color: #ffda00; } /* Fierens */
        .c-blue { color: #00aaff; } /* Nex */

        .game-grid {
            padding: 40px; display: flex; gap: 20px; justify-content: center;
        }
        .game-card {
            width: 200px; height: 240px; background: #222; border: 1px solid #444; cursor: pointer;
            display: flex; flex-direction: column; transition: 0.2s;
        }
        .game-card:hover { border-color: white; transform: scale(1.02); }
        .card-img { height: 150px; background: #444; display: flex; align-items: center; justify-content: center; color: #666; font-size: 40px; }
        .card-info { padding: 15px; }
        .card-title { font-weight: bold; font-size: 18px; margin-bottom: 5px; }
        .play-btn-green {
            width: 100%; padding: 10px; background: #00b06f; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: auto;
        }

        /* --- –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° (HUD) --- */
        #game-ui { display: none; position: absolute; inset: 0; pointer-events: none; z-index: 10; }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –∏–≥—Ä–æ–∫–æ–≤ */
        #leaderboard {
            position: absolute; top: 20px; right: 20px; width: 200px; background: rgba(0,0,0,0.8); color: white; pointer-events: auto;
        }
        .lb-head { background: #333; padding: 8px 12px; font-weight: bold; display: flex; justify-content: space-between; }
        .lb-row { padding: 8px 12px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; }

        /* –ß–∞—Ç */
        #chat-container {
            position: absolute; top: 20px; left: 20px; width: 320px; height: 280px;
            display: flex; flex-direction: column; pointer-events: auto;
        }
        #chat-log { flex: 1; overflow-y: auto; color: white; text-shadow: 1px 1px 2px black; margin-bottom: 10px; font-size: 16px; scrollbar-width: none;}
        #chat-input { 
            width: 100%; padding: 10px; background: rgba(0,0,0,0.6); border: 2px solid transparent; color: white; 
            opacity: 0.5; transition: 0.2s; 
        }
        #chat-input:focus { opacity: 1; background: rgba(0,0,0,0.9); border-color: white; outline: none; }

        /* –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        #error-msg { 
            position: absolute; bottom: 50%; width: 100%; text-align: center; color: #ff4444; font-weight: bold; display: none; text-shadow: 2px 2px 0 #000;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <!-- 1. MENU (HOME) -->
    <div id="home-screen">
        <div class="home-nav">
            <h1 style="margin:0; font-style:italic;">TerNix</h1>
            <div class="currency-box">
                <span class="c-gold">Fierens: 100</span>
                <span class="c-blue">Nex: 50</span>
            </div>
        </div>
        <div style="padding: 40px;">
            <h2>Games</h2>
            <div class="game-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã -->
                <div class="game-card">
                    <div class="card-img">üè∞</div>
                    <div class="card-info">
                        <div class="card-title">Baseplate</div>
                        <div style="color:#aaa; font-size:12px;">By Waztern</div>
                    </div>
                    <button class="play-btn-green" onclick="launchGame()">PLAY</button>
                </div>
                 <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ -->
                 <div class="game-card" style="opacity: 0.5;">
                    <div class="card-img">üëï</div>
                    <div class="card-info">
                        <div class="card-title">Avatar Editor</div>
                        <div style="color:#aaa; font-size:12px;">Coming Soon</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. GAME UI -->
    <div id="game-ui">
        <div id="leaderboard">
            <div class="lb-head"><span>People</span><span>Score</span></div>
            <div id="lb-content"></div>
        </div>

        <div id="chat-container">
            <div id="chat-log"></div>
            <input type="text" id="chat-input" placeholder="Press '/' to chat">
        </div>

        <div id="error-msg">Model Not Found!<br>Ensure 'Ternix.Guy.glb' is in the root folder.</div>
    </div>

    <!-- 3. 3D WORLD -->
    <div id="scene-container"></div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Global State ---
        let scene, camera, renderer, player, controls;
        let keys = { w:false, a:false, s:false, d:false, space:false };
        let velocity = new THREE.Vector3();
        let onGround = true;
        let username = "Waztern"; 
        let isChatting = false;
        let gameActive = false;

        // --- UI Functions ---
        window.launchGame = function() {
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            gameActive = true;
            init3D();
            updateLeaderboard();
            animate();
        }

        function updateLeaderboard() {
            const list = document.getElementById('lb-content');
            // –¢–æ–ª—å–∫–æ —Ç—ã, –±–æ—Ç–æ–≤ —É–±—Ä–∞–ª–∏
            list.innerHTML = `
                <div class="lb-row">
                    <span>${username}</span>
                    <span style="color:#ffda00">100</span>
                </div>
            `;
        }

        // --- 3D ENGINE ---
        function init3D() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 20, 100);

            // Camera
            camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 15);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Controls (Roblox Style: Right Click to Orbit)
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;
            controls.enablePan = false;
            controls.minDistance = 5;
            controls.maxDistance = 30;
            controls.mouseButtons = { LEFT: null, MIDDLE: null, RIGHT: THREE.MOUSE.ROTATE }; // –¢–æ–ª—å–∫–æ –ü–ö–ú –∫—Ä—É—Ç–∏—Ç

            // Lights
            const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
            scene.add(hemiLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
            dirLight.position.set(10, 50, 20);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // Floor
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(200, 200), 
                new THREE.MeshStandardMaterial({ color: 0x44aa44 })
            );
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Grid
            scene.add(new THREE.GridHelper(200, 50));

            // Load Model
            const loader = new GLTFLoader();
            loader.load('./Ternix.Guy.glb', 
                (gltf) => {
                    player = gltf.scene;
                    player.scale.set(1, 1, 1); // Adjust Scale here
                    scene.add(player);
                    
                    // –°–æ–∑–¥–∞–µ–º "–•–∏—Ç–±–æ–∫—Å" –¥–ª—è –∏–≥—Ä–æ–∫–∞
                    player.userData.velocity = new THREE.Vector3();
                }, 
                undefined, 
                (err) => {
                    console.error(err);
                    document.getElementById('error-msg').style.display = 'block';
                    // Fallback Cube
                    const geo = new THREE.BoxGeometry(2, 4, 2);
                    const mat = new THREE.MeshStandardMaterial({color:'red'});
                    player = new THREE.Mesh(geo, mat);
                    player.position.y = 2;
                    scene.add(player);
                    player.userData.velocity = new THREE.Vector3();
                }
            );

            // Input Listeners
            window.addEventListener('keydown', onKeyDown);
            window.addEventListener('keyup', onKeyUp);
        }

        // --- CONTROLS LOGIC ---
        function onKeyDown(e) {
            if (e.key === '/' && !isChatting) {
                e.preventDefault();
                toggleChat(true);
                return;
            }
            if (isChatting) return; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ö–æ–¥—å–±—É –ø—Ä–∏ —á–∞—Ç–µ

            switch(e.code) {
                case 'KeyW': keys.w = true; break;
                case 'KeyS': keys.s = true; break;
                case 'KeyA': keys.a = true; break;
                case 'KeyD': keys.d = true; break;
                case 'Space': if(onGround) velocity.y = 0.5; onGround = false; break;
            }
        }

        function onKeyUp(e) {
            switch(e.code) {
                case 'KeyW': keys.w = false; break;
                case 'KeyS': keys.s = false; break;
                case 'KeyA': keys.a = false; break;
                case 'KeyD': keys.d = false; break;
            }
        }

        // --- CHAT LOGIC ---
        const chatIn = document.getElementById('chat-input');
        chatIn.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                if(chatIn.value.trim()) {
                    const log = document.getElementById('chat-log');
                    log.innerHTML += `<div><b>[${username}]:</b> ${chatIn.value}</div>`;
                    log.scrollTop = log.scrollHeight;
                }
                chatIn.value = '';
                toggleChat(false); // –ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç
            }
        });

        function toggleChat(active) {
            isChatting = active;
            if(active) {
                chatIn.focus();
                // –°–±—Ä–æ—Å –¥–≤–∏–∂–µ–Ω–∏—è —á—Ç–æ–±—ã –Ω–µ –±–µ–∂–∞—Ç—å –≤–µ—á–Ω–æ
                keys.w = keys.a = keys.s = keys.d = false;
            } else {
                chatIn.blur();
            }
        }

        // --- PHYSICS LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            if(!player) return;

            // Camera Follow Target
            controls.target.copy(player.position);
            controls.update();

            if(!isChatting) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
                const camDir = new THREE.Vector3();
                camera.getWorldDirection(camDir);
                camDir.y = 0;
                camDir.normalize();

                const camSide = new THREE.Vector3();
                camSide.crossVectors(camera.up, camDir).normalize(); // –í–ø—Ä–∞–≤–æ

                // –î–≤–∏–∂–µ–Ω–∏–µ
                const speed = 0.2;
                if(keys.w) player.position.addScaledVector(camDir, speed);
                if(keys.s) player.position.addScaledVector(camDir, -speed);
                if(keys.a) player.position.addScaledVector(camSide, speed); // A –∏ D –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ 3JS
                if(keys.d) player.position.addScaledVector(camSide, -speed);

                // –ü–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—É –¥–≤–∏–∂–µ–Ω–∏—è
                if (keys.w || keys.s || keys.a || keys.d) {
                    const moveDir = new THREE.Vector3();
                    if(keys.w) moveDir.add(camDir);
                    if(keys.s) moveDir.sub(camDir);
                    if(keys.a) moveDir.add(camSide);
                    if(keys.d) moveDir.sub(camSide);
                    
                    if (moveDir.length() > 0) {
                        const targetAngle = Math.atan2(moveDir.x, moveDir.z);
                        player.rotation.y = targetAngle;
                    }
                }
            }

            // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –∏ –ü—Ä—ã–∂–æ–∫
            velocity.y -= 0.02; // –°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏
            player.position.y += velocity.y;

            // –ö–æ–ª–ª–∏–∑–∏—è —Å –ø–æ–ª–æ–º
            if(player.position.y <= 0) {
                player.position.y = 0;
                velocity.y = 0;
                onGround = true;
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
