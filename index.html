<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TerNix 3D - Alpha</title>
    <!-- Используем надежный CDN для 3D движка -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        header { position: absolute; top: 0; width: 100%; height: 40px; background: #0044ee; color: white; display: flex; align-items: center; padding: 0 15px; z-index: 100; border-bottom: 2px solid #002288; box-sizing: border-box; }
        header button { background: #fff; border: 1px solid #000; cursor: pointer; font-weight: bold; margin-right: 10px; }
        
        #chat-bar { position: absolute; bottom: 0; width: 100%; background: #fff; border-top: 3px solid #333; padding: 10px; z-index: 200; box-sizing: border-box; }
        #chat-input { width: 100%; border: none; outline: none; font-size: 18px; }
        
        #health-ui { position: absolute; top: 50px; right: 20px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; z-index: 100; }
        #hp-bar { width: 150px; height: 15px; background: #333; border: 2px solid #fff; }
        #hp-fill { width: 100%; height: 100%; background: #ff0000; transition: 0.3s; }
    </style>
</head>
<body>

<header>
    <b>TerNix 3D</b>
    <button onclick="location.reload()">Home</button>
    <button>Games</button>
    <div style="margin-left:auto">Fierens: 50</div>
</header>

<div id="health-ui">
    <div id="hp-bar"><div id="hp-fill"></div></div>
</div>

<div id="chat-bar">
    <input type="text" id="chat-input" placeholder='Press "/" to chat'>
</div>

<script>
    let scene, camera, renderer, player, mixer;
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let canJump = true, velocityY = 0;

    const chatInput = document.getElementById('chat-input');

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
        scene.add(light);

        // Ground
        const grid = new THREE.GridHelper(200, 50, 0x000000, 0x555555);
        scene.add(grid);

        // DAMAGE BLOCK (Красный блок)
        const lavaGeo = new THREE.BoxGeometry(5, 0.5, 5);
        const lavaMat = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        const lava = new THREE.Mesh(lavaGeo, lavaMat);
        lava.position.set(10, 0, -10);
        scene.add(lava);

        // ЗАГРУЗКА МОДЕЛИ ИЗ BLENDER
        const loader = new THREE.GLTFLoader();
        // Убедись, что файл Ternix.Guy.glb лежит в той же папке на GitHub!
        loader.load('Ternix.Guy.glb', function(gltf) {
            player = gltf.scene;
            player.scale.set(1, 1, 1);
            scene.add(player);
            
            // Если в Blender есть анимации:
            if(gltf.animations.length > 0) {
                mixer = new THREE.AnimationMixer(player);
                mixer.clipAction(gltf.animations[0]).play();
            }
        }, undefined, function(error) {
            console.error("Model not found, using fallback cube.");
            // Если модель не найдена, создаем временного кубического челика
            player = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(1, 1.5, 0.5), new THREE.MeshPhongMaterial({color: 0x888888}));
            player.add(body);
            scene.add(player);
        });

        camera.position.set(0, 5, 10);
        animate();
    }

    // Controls
    window.addEventListener('keydown', (e) => {
        if(e.key === '/') { e.preventDefault(); chatInput.focus(); }
        if(document.activeElement === chatInput) return;
        
        switch(e.code) {
            case 'KeyW': moveForward = true; break;
            case 'KeyS': moveBackward = true; break;
            case 'KeyA': moveLeft = true; break;
            case 'KeyD': moveRight = true; break;
            case 'Space': if(canJump) { velocityY = 0.15; canJump = false; } break;
        }
    });

    window.addEventListener('keyup', (e) => {
        switch(e.code) {
            case 'KeyW': moveForward = false; break;
            case 'KeyS': moveBackward = false; break;
            case 'KeyA': moveLeft = false; break;
            case 'KeyD': moveRight = false; break;
        }
    });

    function animate() {
        requestAnimationFrame(animate);

        if(player) {
            if(moveForward) player.translateZ(-0.1);
            if(moveBackward) player.translateZ(0.1);
            if(moveLeft) player.rotation.y += 0.05;
            if(moveRight) player.rotation.y -= 0.05;

            // Прыжок и гравитация
            player.position.y += velocityY;
            if(player.position.y > 0) {
                velocityY -= 0.008;
            } else {
                player.position.y = 0;
                velocityY = 0;
                canJump = true;
            }

            // Камера следит за игроком
            const offset = new THREE.Vector3(0, 5, 10).applyQuaternion(player.quaternion);
            camera.position.copy(player.position).add(offset);
            camera.lookAt(player.position);
        }

        renderer.render(scene, camera);
    }

    chatInput.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') { chatInput.blur(); }
    });

    init();
</script>
</body>
</html>
